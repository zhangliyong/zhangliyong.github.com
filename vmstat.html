<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Lyon's Blog</title>
	<meta name="description" content="">
	<meta name="author" content="zhang liyong">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="./theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="./theme/bootstrap.min.css" rel="stylesheet">
	<link href="./theme/local.css" rel="stylesheet">
	<link href="./theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
        
		</head>
<body>
			<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="./">Lyon's Blog</a>
			<ul class="nav">
																			<li><a href="./pages/about.html">About</a></li>
																		<li ><a href="./category/algorithm.html">algorithm</a></li>
									<li ><a href="./category/bash.html">bash</a></li>
									<li ><a href="./category/db.html">db</a></li>
									<li ><a href="./category/emacs.html">emacs</a></li>
									<li ><a href="./category/git.html">git</a></li>
									<li class="active"><a href="./category/linux.html">linux</a></li>
									<li ><a href="./category/misc.html">misc</a></li>
									<li ><a href="./category/mongo.html">mongo</a></li>
									<li ><a href="./category/munin.html">munin</a></li>
									<li ><a href="./category/mysql.html">mysql</a></li>
									<li ><a href="./category/network.html">network</a></li>
									<li ><a href="./category/nginx.html">nginx</a></li>
									<li ><a href="./category/python.html">python</a></li>
									<li ><a href="./category/vim.html">vim</a></li>
							</ul>
			<p class="pull-right"><a href="./archives.html">[archives]</a> <a href="./tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
								<li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
								<li><a href="http://python.org">Python.org</a></li>
								<li><a href="http://jinja.pocoo.org">Jinja2</a></li>
								<li><a href="#">You can modify those links in your config file</a></li>
							</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
								<li><a href="#">You can add links in your config file</a></li>
								<li><a href="#">Another social link</a></li>
							</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
							<div class='article'>
		<div class="page-header"><h1>vmstat</h1></div>
		<div class="well small">Permalink: <a class="more" href="./vmstat.html">2013-07-25 11:35:02</a>
by <a class="url fn" href="./author/zhang-liyong.html">zhang liyong </a>
 in <a href="./category/linux.html">linux</a>
</div>
		<div><p>最近在分析mongo的性能问题，发现mongo所在机器的io比较频繁。</p>
<p>使用vmstat命令查看，发现b（The number of processes in uninterruptible sleep）这一列的数量比较大，持续在4左右。
随后查询uninterruptible sleep状态的意义，引自：http://www.novell.com/support/kb/doc.php?id=7002725</p>
<blockquote>
<p>Processes in a "D" or uninterruptible sleep state are usually waiting on I/O. The ps command shows a "D" on processes in an uninterruptible sleep state. The vmstat command also shows the current processes that are "blocked" or waiting on I/O. The vmstat and ps will not agree on the number of processes in a "D" state, so don't be too concerned. You cannot kill "D" state processes, even with SIGKILL or kill -9. As the name implies, they are uninterruptible. You can only clear them by rebooting the server or waiting for the I/O to respond. It is normal to see processes in a "D" state when the server performs I/O intensive operations. </p>
<p>If performance becomes an issue, you may need to check the health of your disks. Make sure your firmware and kernel disk drivers are updated. </p>
<p>In the example above, there is heavy disk activity shown in the "io" columns and the server is currently swapping to disk. The example more likely represents a memory issue, rather than a disk I/O issue. </p>
<p>There are two ways to find more about the processes in D state.</p>
<ol>
<li>
<p>ps -eo ppid,pid,user,stat,pcpu,comm,wchan:32
This prints a list of all processes where in the last column either a '-' is displayed when the process is running or the name of the kernel function in which the process is sleeping if the process is currently sleeping. This includes also processes which are interruptible. Processes that are in uninterruptible sleep can be determined via the fourth column which would then show a D.</p>
</li>
<li>
<p>echo w &gt; /proc/sysrq-trigger
This command produces a report and a list of all processes in D state and a full kernel stack trace to /var/log/messages. This shows much more information than the first option described above.</p>
</li>
</ol>
</blockquote>
<p>关于vmstat的使用参考：http://www.linuxintheshell.org/2013/05/22/episode-030-vmstat/</p></div>
		<div>
			<h2>Comments</h2>
		 									<div>
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; zhang liyong</p>
		</footer>
	  </div>

	</div>
</body>
</html>