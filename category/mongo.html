<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Lyon's Blog</title>
	<meta name="description" content="">
	<meta name="author" content="zhang liyong">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="../theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="../theme/bootstrap.min.css" rel="stylesheet">
	<link href="../theme/local.css" rel="stylesheet">
	<link href="../theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
        
		</head>
<body>
			<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="../">Lyon's Blog</a>
			<ul class="nav">
																			<li><a href="../pages/about.html">About</a></li>
																		<li ><a href="../category/algorithm.html">algorithm</a></li>
									<li ><a href="../category/bash.html">bash</a></li>
									<li ><a href="../category/db.html">db</a></li>
									<li ><a href="../category/emacs.html">emacs</a></li>
									<li ><a href="../category/git.html">git</a></li>
									<li ><a href="../category/linux.html">linux</a></li>
									<li ><a href="../category/misc.html">misc</a></li>
									<li class="active"><a href="../category/mongo.html">mongo</a></li>
									<li ><a href="../category/munin.html">munin</a></li>
									<li ><a href="../category/mysql.html">mysql</a></li>
									<li ><a href="../category/network.html">network</a></li>
									<li ><a href="../category/nginx.html">nginx</a></li>
									<li ><a href="../category/python.html">python</a></li>
									<li ><a href="../category/vim.html">vim</a></li>
							</ul>
			<p class="pull-right"><a href="../archives.html">[archives]</a> <a href="../tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
								<li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
								<li><a href="http://python.org">Python.org</a></li>
								<li><a href="http://jinja.pocoo.org">Jinja2</a></li>
								<li><a href="#">You can modify those links in your config file</a></li>
							</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
								<li><a href="#">You can add links in your config file</a></li>
								<li><a href="#">Another social link</a></li>
							</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
			<div class="page-header"><h1>Lyon's Blog <small>mongo</small></h1></div>			
<div class='article'>
	<h2>How mongodb use memory</h2>
	<div class="well small">Permalink: <a class="more" href="../how-mongodb-use-memory.html">2013-07-29 15:11:21</a>
by <a class="url fn" href="../author/zhang-liyong.html">zhang liyong </a>
 in <a href="../category/mongo.html">mongo</a>
</div>
	<div class="summary"><p>网络上经常有文章说mongo会需要大量内存，那么mongo到低需要多少内存。</p>
<p>MongoDB实际需要的内存大小取决于working set的大小，working set是mongo完成操作所需要的所有文档及索引。对于一个collection而言，如果不需要访问每一条记录，不需要所有的记录都在内存中。working set最好都在内存中，以保证好的性能，如果不都在内存中会出现比较多的page fault。</p>
<p>查看working set大小可用如下命令：<code>db.runCommand( { serverStatus: 1, workingSet: 1 } )</code></p>
<p>serverStatus.mem.resident
The value of resident is roughly equivalent to the amount of RAM, in megabytes (MB), currently used by the database process. In normal use this ...</p> <a class="btn primary xsmall" href="../how-mongodb-use-memory.html">more…</a>
	</div>
</div>	
<div class='article'>
	<h2>Mongo Performance</h2>
	<div class="well small">Permalink: <a class="more" href="../mongo-performance.html">2013-07-25 10:07:12</a>
by <a class="url fn" href="../author/zhang-liyong.html">zhang liyong </a>
 in <a href="../category/mongo.html">mongo</a>
</div>
	<div class="summary"><p>最近mongo的性能</p> <a class="btn primary xsmall" href="../mongo-performance.html">more…</a>
	</div>
</div>	
<div class='article'>
	<h2>Mongo</h2>
	<div class="well small">Permalink: <a class="more" href="../mongo.html">2013-07-24 17:36:09</a>
by <a class="url fn" href="../author/zhang-liyong.html">zhang liyong </a>
 in <a href="../category/mongo.html">mongo</a>
</div>
	<div class="summary"><h2>query after update slow</h2>
<p>这两天有一个接口的速度非常慢，主要是执行一条查询语句非常慢，有时耗时达200秒，于是找到了这条查询语句单独在mongo shell中执行，在mongo shell中执行并不慢，慢慢调试后最终找到问题，原因是在查询语句执行之前执行了两次更新语句。</p>
<p>利用pymongo执行更新时，如果不设置safe=True，mongo会及时返回函数调用，但更新并没有真正执行完，mongo进程在后台继续执行，所以当接着执行查询时，此时更新没有结束，数据库会处于lock状态，查询等待数据库解锁，所以查询非常慢。</p>
<p>把更新语句去除后，查询恢复正常。</p>
<h2>Concurrency</h2>
<p>MongoDB global lock to ga</p>
<h2>Tips</h2>
<h3>If Write Heavy</h3>
<p>Global Lock is Global
As you probably know, MongoDB has a global lock. The ...</p> <a class="btn primary xsmall" href="../mongo.html">more…</a>
	</div>
</div>	
<div class='article'>
	<h2>Mongodb NUMA 导致的性能问题</h2>
	<div class="well small">Permalink: <a class="more" href="../mongodb-numa-dao-zhi-de-xing-neng-wen-ti.html">2013-05-08 13:45:46</a>
by <a class="url fn" href="../author/zhang-liyong.html">zhang liyong </a>
 in <a href="../category/mongo.html">mongo</a>
</div>
	<div class="summary"><p>最近升级了mongodb，用mongo连接mongod后出现如下warning:</p>
<div class="highlight"><pre><span class="n">Server</span> <span class="n">has</span> <span class="n">startup</span> <span class="n">warnings</span><span class="o">:</span>
<span class="n">Mon</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">14</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">23</span> <span class="p">[</span><span class="n">initandlisten</span><span class="p">]</span>
<span class="n">Mon</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">14</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">23</span> <span class="p">[</span><span class="n">initandlisten</span><span class="p">]</span> <span class="o">**</span> <span class="n">WARNING</span><span class="o">:</span> <span class="n">You</span> <span class="n">are</span> <span class="n">running</span> <span class="n">on</span> <span class="n">a</span> <span class="n">NUMA</span> <span class="n">machine</span><span class="p">.</span>
<span class="n">Mon</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">14</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">23</span> <span class="p">[</span><span class="n">initandlisten</span><span class="p">]</span> <span class="o">**</span>          <span class="n">We</span> <span class="n">suggest</span> <span class="n">launching</span> <span class="n">mongod</span> <span class="n">like</span> <span class="n">this</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">performance</span> <span class="n">problems</span><span class="o">:</span>
<span class="n">Mon</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">14</span><span class="o">:</span><span class="mi">45 ...</span></pre></div> <a class="btn primary xsmall" href="../mongodb-numa-dao-zhi-de-xing-neng-wen-ti.html">more…</a>
	</div>
</div>	


		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; zhang liyong</p>
		</footer>
	  </div>

	</div>
</body>
</html>