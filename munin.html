<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Lyon's Blog</title>
	<meta name="description" content="">
	<meta name="author" content="zhang liyong">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="./theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="./theme/bootstrap.min.css" rel="stylesheet">
	<link href="./theme/local.css" rel="stylesheet">
	<link href="./theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
        
		</head>
<body>
			<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="./">Lyon's Blog</a>
			<ul class="nav">
																			<li><a href="./pages/about.html">About</a></li>
																		<li ><a href="./category/algorithm.html">algorithm</a></li>
									<li ><a href="./category/bash.html">bash</a></li>
									<li ><a href="./category/db.html">db</a></li>
									<li ><a href="./category/emacs.html">emacs</a></li>
									<li ><a href="./category/git.html">git</a></li>
									<li ><a href="./category/linux.html">linux</a></li>
									<li ><a href="./category/misc.html">misc</a></li>
									<li ><a href="./category/mongo.html">mongo</a></li>
									<li class="active"><a href="./category/munin.html">munin</a></li>
									<li ><a href="./category/mysql.html">mysql</a></li>
									<li ><a href="./category/network.html">network</a></li>
									<li ><a href="./category/nginx.html">nginx</a></li>
									<li ><a href="./category/python.html">python</a></li>
									<li ><a href="./category/vim.html">vim</a></li>
							</ul>
			<p class="pull-right"><a href="./archives.html">[archives]</a> <a href="./tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
								<li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
								<li><a href="http://python.org">Python.org</a></li>
								<li><a href="http://jinja.pocoo.org">Jinja2</a></li>
								<li><a href="#">You can modify those links in your config file</a></li>
							</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
								<li><a href="#">You can add links in your config file</a></li>
								<li><a href="#">Another social link</a></li>
							</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
							<div class='article'>
		<div class="page-header"><h1>munin</h1></div>
		<div class="well small">Permalink: <a class="more" href="./munin.html">2013-08-05 13:17:46</a>
by <a class="url fn" href="./author/zhang-liyong.html">zhang liyong </a>
 in <a href="./category/munin.html">munin</a>
</div>
		<div><h2>Writing plugins</h2>
<p>global attribute: http://munin-monitoring.org/wiki/protocol-config</p>
<p>redis munin 有改动，总是说Redis找不到，一会儿一下问题，做一个patch</p>
<p>mulitgraph: http://munin-monitoring.org/wiki/protocol-multigraph</p>
<h2>fw_conntract fw_forwarded_local timeout</h2>
<p>配置好munin之后，fw_conntrack总是报警，读不到数据，主要原因是执行fw_conntrack超时，munin plugin的默认超时时间是10s，超时主要是因为<code>cat /proc/net/ip_conntrack</code>，对于网络请求少的服务器，此语句会很快执行完，但对于网络请求比较多的服务器，此语句耗时可能要超过30s。</p>
<p>Google的相应问题，此问题早已被人解决，解决方案见如下链接：
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=565565</p>
<p>主要就是用<code>conntrack -L</code> 代替<code>cat /proc/net/ip_conntrack</code>，要先安装<code>sudo apt-get install conntrack</code></p>
<h2>limits</h2>
<p>limit 用于检查每个plugin的field的值是否超出设定的warning和critical，并做出相应的警报。</p>
<p>warning和critical是运行插件config输出的每个filed的warning和critical来设置的。</p>
<p>有时我们在<code>/etc/munin/plugin-conf.d/</code>中会看到<code>env.warning value</code>，这是因为插件会读取<code>env.warning</code>的值，并根据此值设置每个field的warning。如果插件不读取<code>env.warning</code>的值，即使设置也不会启作用，munin不会自动设置。</p>
<p>关于warning, critical的设置可参考: <a href="http://munin-monitoring.org/wiki/fieldname.warning">{fieldname}.warning</a>, <a href="http://munin-monitoring.org/wiki/fieldname.critical">{fieldname}.critical}</a></p>
<p>http://munin-monitoring.org/wiki/protocol-config</p>
<p>http://munin-monitoring.org/wiki/munin-man#munin-html</p></div>
		<div>
			<h2>Comments</h2>
		 									<div>
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; zhang liyong</p>
		</footer>
	  </div>

	</div>
</body>
</html>